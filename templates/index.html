<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cookie Clicker Multijoueur</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            background-color: #f0f8ff;
            color: #333;
            margin-top: 50px;
        }
        h1 {
            color: #4CAF50;
        }
        #cookie {
            font-size: 150px; /* Un gros cookie ! */
            cursor: pointer;
            user-select: none; /* Emp√™che la s√©lection du texte en cliquant */
            transition: transform 0.1s ease-out; /* Petite animation au clic */
            display: inline-block; /* Pour l'animation */
        }
        #cookie:active {
            transform: scale(0.95); /* Le cookie r√©tr√©cit un peu quand on clique */
        }
        #scores {
            margin-top: 30px;
            padding: 20px;
            background-color: #e6f7ff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        .player-score {
            font-size: 20px;
            margin: 10px 0;
            font-weight: bold;
            color: #007bff;
        }
        .player-score:nth-child(odd) {
            color: #ff6347; /* Couleur diff√©rente pour l'alternance des joueurs */
        }
    </style>
</head>
<body>
    <h1>üç™ Cookie Clicker Multijoueur Local üç™</h1>

    <div id="cookie">üç™</div>

    <div id="scores">
        <h2>Scores des joueurs</h2>
        <p>En attente des joueurs...</p>
    </div>

    <script>
        // Initialise la connexion Socket.IO au serveur
        var socket = io();

        // R√©cup√®re l'√©l√©ment du cookie
        const cookieButton = document.getElementById('cookie');
        // R√©cup√®re l'√©l√©ment o√π les scores seront affich√©s
        const scoresContainer = document.getElementById('scores');

        // Ajoute un √©couteur d'√©v√©nements pour les clics sur le cookie
        cookieButton.addEventListener('click', function() {
            // √âmet un √©v√©nement 'click_event' au serveur
            socket.emit('click_event');
        });

        // G√®re l'√©v√©nement 'update_score' re√ßu du serveur
        // Cet √©v√©nement est √©mis chaque fois qu'un joueur clique
        socket.on('update_score', function(data) {
            // La 'data' contient { player_id: '...', score: X }
            console.log("Mise √† jour du score re√ßue :", data);
            updatePlayerScoreDisplay(data.player_id, data.score);
        });

        // G√®re l'√©v√©nement 'current_scores' re√ßu du serveur
        // Cet √©v√©nement est √©mis lors de la connexion/d√©connexion d'un joueur ou au d√©marrage
        socket.on('current_scores', function(allPlayersScores) {
            console.log("Tous les scores re√ßus :", allPlayersScores);
            scoresContainer.innerHTML = '<h2>Scores des joueurs</h2>'; // Nettoie l'affichage actuel

            if (Object.keys(allPlayersScores).length === 0) {
                scoresContainer.innerHTML += '<p>En attente des joueurs...</p>';
            } else {
                // Parcourt tous les scores et les affiche
                for (const playerId in allPlayersScores) {
                    if (allPlayersScores.hasOwnProperty(playerId)) {
                        updatePlayerScoreDisplay(playerId, allPlayersScores[playerId]);
                    }
                }
            }
        });

        /**
         * Met √† jour ou cr√©e l'affichage du score d'un joueur sp√©cifique.
         * @param {string} playerId L'ID unique du joueur.
         * @param {number} score Le score actuel du joueur.
         */
        function updatePlayerScoreDisplay(playerId, score) {
            let playerScoreDiv = document.getElementById('player-' + playerId);

            if (!playerScoreDiv) {
                // Si l'√©l√©ment n'existe pas, il faut le cr√©er
                playerScoreDiv = document.createElement('div');
                playerScoreDiv.id = 'player-' + playerId;
                playerScoreDiv.className = 'player-score';
                scoresContainer.appendChild(playerScoreDiv);
            }
            // Affiche seulement une partie de l'ID pour le rendre plus lisible
            const displayId = playerId.substring(0, 5);
            playerScoreDiv.textContent = `Joueur ${displayId}: ${score} clics`;

            // R√©organise les scores pour qu'ils soient tri√©s par score (d√©croissant)
            // C'est un peu plus avanc√©, mais √ßa rend l'affichage plus dynamique
            const scoreElements = Array.from(scoresContainer.querySelectorAll('.player-score'));
            scoreElements.sort((a, b) => {
                const scoreA = parseInt(a.textContent.split(': ')[1]);
                const scoreB = parseInt(b.textContent.split(': ')[1]);
                return scoreB - scoreA; // Tri d√©croissant
            });
            scoreElements.forEach(el => scoresContainer.appendChild(el));
        }
    </script>
</body>
</html>
